environment:
  contents:
    packages:
      - build-base
      - busybox
      - bzip2-dev
      - ca-certificates-bundle
      - expat-dev
      - gdbm-dev
      - libffi-dev
      - libx11-dev
      - linux-headers
      - ncurses-dev
      - openssl-dev
      - python3
      - readline-dev
      - sqlite-dev
      - tcl-dev
      - tk-dev
      - wolfi-base
      - xz-dev
      - zlib-dev

package:
  copyright:
    - license: PSF-2.0
  description: A graphical user interface for the Python programming language
  epoch: 0
  name: py3-tkinter
  version: 3.11.9

pipeline:
  - uses: fetch
    with:
      expected-sha256: 9b1e896523fc510691126c864406d9360a3d1e986acbda59cda57b5abda45b87
      uri: https://www.python.org/ftp/python/${{package.version}}/Python-${{package.version}}.tar.xz

  - runs: "export CFLAGS=\"${CFLAGS/-Os/} -fno-semantic-interposition\"\nexport LDFLAGS=\"$LDFLAGS -fno-semantic-interposition\"\n./configure \\\n\t--build=$CBUILD \\\n\t--host=$CHOST \\\n\t--prefix=/usr \\\n\t--enable-ipv6 \\\n\t--enable-loadable-sqlite-extensions \\\n\t--enable-shared \\\n\t--with-computed-gotos \\\n\t--with-dbmliborder=gdbm:ndbm \\\n\t--with-system-expat \\\n\t--with-system-ffi\n\n  make EXTRA_CFLAGS=\"$CFLAGS -DTHREAD_STACK_SIZE=0x100000\"\n"

  - runs: "pkgver=${{package.version}}\n_basever=\"${pkgver%.*}\"\nmake DESTDIR=./tmpinstall sharedinstall libinstall\nmkdir -p \"${{targets.destdir}}\"/usr/lib/python$_basever/lib-dynload \\\n\t\"${{targets.destdir}}\"/usr/bin\nfor lib in idlelib tkinter; do\n mv ./tmpinstall/usr/lib/python$_basever/$lib \\\n\t\t\"${{targets.destdir}}\"/usr/lib/python$_basever/\ndone\n\nmv ./tmpinstall/usr/lib/python$_basever/lib-dynload/_tkinter*.so \\\n\"${{targets.destdir}}\"/usr/lib/python$_basever/lib-dynload/\nmv ./tmpinstall/usr/bin/idle* \\\n\t\"${{targets.destdir}}\"/usr/bin/\n"

  - uses: strip

test:
  environment:
    contents:
      packages:
        - busybox
  pipeline:
    - uses: py/pip-check

update:
  enabled: true
  github:
    identifier: python/cpython
    strip-prefix: v
    tag-filter: v3.11
    use-tag: true
  shared: true
