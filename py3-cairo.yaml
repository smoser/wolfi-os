environment:
  contents:
    packages:
      - build-base
      - busybox
      - ca-certificates-bundle
      - cairo-dev
      - cmake
      - expat-dev
      - fontconfig-dev
      - freetype-dev
      - libpng-dev
      - meson
      - python3-dev
      - zlib-dev

package:
  copyright:
    - license: LGPL-2.0-or-later
  dependencies:
    runtime:
      - python3
  description: Python3 bindings for the cairo graphics library
  epoch: 0
  name: py3-cairo
  version: 1.26.1

pipeline:
  - uses: git-checkout
    with:
      expected-commit: 49c89e21c9f11006d37841f920af060cc7d70999
      repository: https://github.com/pygobject/pycairo
      tag: v${{package.version}}

  - uses: meson/configure
    with:
      opts: '-Db_lto=true

      '

  - uses: meson/compile

  - uses: meson/install

  - runs: python3 -m compileall "${{targets.destdir}}"/usr/lib

  - uses: strip

subpackages:
  - dependencies:
      runtime:
        - py3-cairo
    description: py3-cairo dev
    name: py3-cairo-dev
    pipeline:
      - uses: split/dev

test:
  pipeline:
    - runs: "LIBRARY=\"cairo\"\nIMPORT_STATEMENT=\"import cairo\"\n\nif ! python3 -c \"$IMPORT_STATEMENT\"; then\n    echo \"Failed to import library '$LIBRARY'.\"\n    python3 -c \"$IMPORT_STATEMENT\" 2>&1\n    exit 1\nelse\n    echo \"Library '$LIBRARY' is installed and can be imported successfully.\"\n    exit 0\nfi\n"
    - uses: py/pip-check

update:
  enabled: true
  github:
    identifier: pygobject/pycairo
    strip-prefix: v
