environment:
  contents:
    packages:
      - build-base
      - busybox
      - ca-certificates-bundle
      - wolfi-base

package:
  copyright:
    - license: MIT
  dependencies:
    runtime:
      - git
      - python-3
  description: Quickly rewrite git repository history
  epoch: 0
  name: py3-git-filter-repo
  version: 2.45.0

pipeline:
  - uses: git-checkout
    with:
      expected-commit: c67e73e593c04092fb1d14053b535c2b08ca218f
      repository: https://github.com/newren/git-filter-repo
      tag: v${{package.version}}

  - name: Python Build
    uses: python/build-wheel

  - uses: strip

test:
  pipeline:
    - runs: "cd $(mktemp -d)\ngit init\ngit config user.email \"you@example.com\"\ngit config user.name \"Your Name\"\ntouch README.md TEST.md\ngit add *\ngit commit -m \"Add files\"\ngit filter-repo --path README.md --force\ncount=$(ls |wc -l)\nif [ $count -ne 1 ]; then\n  echo \"failed to filter repo\"\n  exit 1\nfi\n"
    - uses: py/pip-check

update:
  enabled: true
  github:
    identifier: newren/git-filter-repo
    strip-prefix: v
